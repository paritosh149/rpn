<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>RPN on WebAssembly</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cjrtnc.leaningtech.com/2.1/loader.js"></script>
</head>
<style>
.full-width {
	text-align: center;
	height: 100%;
}
</style>
<body class="full-width">
<h2>RPN Calculator</h2><br />
<h3>Available functions are +, - , * /</h3>
<h3>Available commands are undo, clear</h3>
<h3>Example: 12 3 + would result 15</h3>
<h4>Enter: <input id="inputLine" /></h4><br />
<button id="calcBtn" onClick="calculate()" >Calculate</button>
<button onClick="calculate('undo')">Undo</button>
<button onClick="calculate('clear')">Clear</button>
<br />
<h4>Result: <strong id="result"></strong></h4>
<h5>Console:</h5>
<div name="console" id="console" ></div>

</body>
<script>
	/*function showPreloadProgress(loadedFiles, totalFiles)
	{
		console.log("Percentage loaded "+(loadedFiles*100/totalFiles));
	}
	var cheerpjListener = {preloadProgress:showPreloadProgress};
	cheerpjInit({listener:cheerpjListener});
	*/
	cheerpjInit();
    //cheerpjCreateDisplay(800,600);
	// py "d:\cheerpj_2.1\cheerpjfy.py" "rpn-1.0-SNAPSHOT.jar"
	// py -m http.server 8081
	
    cheerpjRunMain("com.example.calculator.MainWasm","/app/"+window.location.pathname+"rpn-1.0-SNAPSHOT.jar");
	var calculator = cjNew("com.example.calculator.CalculatorImpl")
	var result="";
	function calculate() {
		var inputLine = document.getElementById("inputLine").value;
		if(arguments.length>0)
			inputLine = arguments[0]
		cjCall(calculator, "processInputLine", inputLine).then(showResult);
	}
	
	function showResult(resultValue) {
		result = new TextDecoder("utf-16le").decode(resultValue.value0); 
		result = result.substring(1); 
		console.log(result);
		document.getElementById("result").innerHTML = result;
	}
	console.log(window.location.pathname);
	
	
	// Get the input field
	var input = document.getElementById("inputLine");

	// Execute a function when the user releases a key on the keyboard
	input.addEventListener("keyup", function(event) {
	  // Number 13 is the "Enter" key on the keyboard
	  if (event.keyCode === 13) {
		// Cancel the default action, if needed
		event.preventDefault();
		// Trigger the button element with a click
		document.getElementById("calcBtn").click();
	  }
	});
	
</script>
</html>
